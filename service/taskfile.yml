version: "3"

output: prefixed

tasks:
  default:
    - task: prepare
    - task: check
    - task: test
    - task: integration

  clean:
    - rm -rf output

  tidy:
    - task: clean
    - go get -u ./...
    - go mod tidy

  prepare:
    - go get ./...
    - go generate -v ./...

  check:
    - golangci-lint run --allow-parallel-runners

  test:
    - go test ./internal/... -v

  integration:
    - go test ./tests/... -v

  integrationUpdate:
    cmds:
      - go test ./tests/... -v
    env:
      UPDATE_SNAPSHOTS: true

  build:
    - task: prepare
    - task: check
    - task: test
    - go build -o output/nrl ./cmd/nrl/*

  run:
    - task: prepare
    - task: check
    - go run ./cmd/nrl/*
